# Jira Integration Service

This service creates Jira tasks and subtasks from LLM responses. It integrates with the Jira REST API to automatically create issues based on structured task breakdowns and action items generated by LLM models.

## Features

- Creates Jira tasks from LLM-generated task breakdowns
- Creates subtasks linked to parent tasks
- Processes action items as standalone tasks
- Maps Russian priority levels to Jira priorities
- Handles task descriptions, assignees, and due dates
- Provides detailed error reporting

## Configuration

Set the following environment variables:

- `JIRA_URL`: Your Jira instance URL (e.g., `https://your-domain.atlassian.net`)
- `JIRA_EMAIL`: Your Jira account email
- `JIRA_API_TOKEN`: Your Jira API token (generate at https://id.atlassian.com/manage-profile/security/api-tokens)
- `JIRA_PROJECT_KEY`: The project key where tasks will be created (default: `PROJ`)
- `JIRA_ISSUE_TYPE`: Issue type for parent tasks (default: `Task`)
- `JIRA_SUBTASK_ISSUE_TYPE`: Issue type for subtasks (default: `Sub-task`)
- `JIRA_EPIC_ISSUE_TYPE`: Issue type for epics (default: `Epic`)
- `OPENAI_API_KEY`: Your OpenAI API key (required for `/jira/process-meeting` endpoint)
- `OPENAI_JIRA_MODEL`: OpenAI model to use (default: `gpt-5-nano`)

## API Endpoints

### POST `/jira/process-meeting`

**Main endpoint**: Process meeting data using OpenAI API and automatically create Jira tasks, epics, and subtasks.

This endpoint:
1. Sends meeting transcript/summary to OpenAI API
2. Gets structured response with epics, tasks, and subtasks
3. Creates corresponding Jira issues automatically

**Request Body:**
```json
{
  "meeting_transcript": "Full transcript of the meeting...",
  "meeting_summary": "Brief summary of the meeting",
  "meeting_metadata": {},
  "create_epics": true,
  "create_subtasks": true
}
```

**Response:**
```json
{
  "success": true,
  "created_tasks": [
    {
      "issue_type": "Epic",
      "issue_key": "PROJ-123",
      "issue_url": "https://your-domain.atlassian.net/browse/PROJ-123",
      "parent_key": null,
      "child_keys": ["PROJ-124", "PROJ-125"],
      "child_urls": ["...", "..."]
    },
    {
      "issue_type": "Task",
      "issue_key": "PROJ-124",
      "issue_url": "...",
      "parent_key": "PROJ-123",
      "child_keys": ["PROJ-126"],
      "child_urls": ["..."]
    }
  ],
  "errors": [],
  "llm_response": { ... }
}
```

**Example:**
```bash
curl -X POST http://localhost:18003/jira/process-meeting \
  -H "Content-Type: application/json" \
  -d '{
    "meeting_summary": "Sprint planning meeting - discussed authentication implementation",
    "meeting_transcript": "John: We need to implement OAuth2...",
    "create_epics": true,
    "create_subtasks": true
  }'
```

### POST `/jira/create-tasks`

Creates Jira tasks and subtasks from an LLM response.

**Request Body:**
```json
{
  "llm_response": {
    "epics": [
      {
        "name": "Auth Implementation",
        "summary": "Implement user authentication system",
        "description": "Add OAuth2 authentication to the application",
        "priority": "высокий",
        "tasks": [
          {
            "summary": "Set up OAuth2 provider",
            "description": "Configure Auth0 provider",
            "priority": "высокий",
            "assignee": "developer@example.com",
            "due_date": "2024-12-31",
            "subtasks": [
              {
                "title": "Get API keys",
                "description": "Request API keys from provider",
                "assignee": "developer@example.com"
              }
            ]
          }
        ]
      }
    ],
    "standalone_tasks": [],
    "action_items": [
      {
        "description": "Review security requirements",
        "owner": "security@example.com",
        "due_date": "2024-12-20",
        "priority": "высокий"
      }
    ]
  },
  "meeting_summary": "Sprint planning meeting",
  "create_subtasks": true
}
```

**Response:**
```json
{
  "success": true,
  "created_tasks": [
    {
      "issue_type": "Epic",
      "issue_key": "PROJ-123",
      "issue_url": "https://your-domain.atlassian.net/browse/PROJ-123",
      "parent_key": null,
      "child_keys": ["PROJ-124"],
      "child_urls": ["..."]
    },
    {
      "issue_type": "Task",
      "issue_key": "PROJ-124",
      "issue_url": "...",
      "parent_key": "PROJ-123",
      "child_keys": ["PROJ-125"],
      "child_urls": ["..."]
    }
  ],
  "errors": [],
  "llm_response": { ... }
}
```

### GET `/health`

Health check endpoint that returns service status and Jira configuration status.

**Response:**
```json
{
  "status": "healthy",
  "jira_configured": true,
  "jira_url": "https://your-domain.atlassian.net"
}
```

## Usage Examples

### Process Meeting Automatically (Recommended)

```bash
curl -X POST http://localhost:18003/jira/process-meeting \
  -H "Content-Type: application/json" \
  -d '{
    "meeting_summary": "Sprint planning - discussed authentication implementation",
    "meeting_transcript": "John: We need to implement OAuth2 authentication. Mary: I can handle the frontend integration. John: Great, let'\''s target end of month.",
    "create_epics": true,
    "create_subtasks": true
  }'
```

### Create Tasks from LLM Response

```bash
curl -X POST http://localhost:18003/jira/create-tasks \
  -H "Content-Type: application/json" \
  -d '{
    "llm_response": {
      "epics": [
        {
          "name": "Auth System",
          "summary": "Implement authentication system",
          "description": "Full OAuth2 implementation",
          "priority": "высокий",
          "tasks": [
            {
              "summary": "Set up OAuth2",
              "description": "Configure provider",
              "priority": "высокий",
              "subtasks": []
            }
          ]
        }
      ],
      "action_items": []
    },
    "create_subtasks": true
  }'
```

### Using Python

```python
import requests

url = "http://localhost:18003/jira/create-tasks"
payload = {
    "llm_response": {
        "task_breakdown": [
            {
                "parent_task": "Implement feature X",
                "description": "Full description of the feature",
                "priority": "средний",
                "subtasks": [
                    {
                        "title": "Subtask 1",
                        "owner": "developer@example.com",
                        "due_date": "2024-12-31"
                    }
                ]
            }
        ],
        "action_items": []
    },
    "create_subtasks": True
}

response = requests.post(url, json=payload)
print(response.json())
```

## Integration with Meeting Insights

The service integrates seamlessly with your meeting insights workflow:

**Option 1: Automatic Processing (Recommended)**
1. Meeting is transcribed
2. Send meeting transcript/summary to `/jira/process-meeting`
3. Service calls OpenAI API to generate structured tasks
4. Jira tasks, epics, and subtasks are created automatically

**Option 2: Manual Processing**
1. Meeting is transcribed
2. Meeting insights worker processes the transcript
3. Send the LLM response to `/jira/create-tasks`
4. Jira tasks and subtasks are created from the structured response

## Priority Mapping

The service maps Russian priority levels to Jira priorities:
- `высокий` → `High`
- `средний` → `Medium`
- `низкий` → `Low`

## Error Handling

The service provides detailed error reporting. If some tasks fail to create, they will be listed in the `errors` array of the response, while successfully created tasks will still be returned.

## Notes

- Jira assignees should be provided as account IDs or email addresses (depending on your Jira configuration)
- Due dates should be in ISO 8601 format (YYYY-MM-DD or YYYY-MM-DDTHH:MM:SS)
- Task summaries are limited to 255 characters (Jira limitation)
- The service uses Jira REST API v3

